---
title: " Modern Data Mining, HW 1"
author:
- Daniel Park
- Elliot Banks
- Wilson Zhang
date: 'Due: 11:59PM,  Feb 1, 2026'
output:
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: '4'
  html_document:
    code_folding: show
    highlight: haddock
    number_sections: yes
    theme: lumen
    toc: yes
    toc_depth: 4
    toc_float: yes
  word_document:
    toc: yes
    toc_depth: '4'
urlcolor: blue
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "hide", fig.width=8, fig.height=4)
options(scipen = 0, digits = 3)  # controls base R output
# check if you have ISLR package, if not, install it
if(!require('pacman')) {install.packages('pacman')}
pacman::p_load(ISLR, readxl, tidyverse, magrittr, dplyr, ggplot2)

library(readr)
library(dplyr)
```


\pagebreak

# Overview

This is a fast-paced course that covers a lot of material. There will be a large amount of references. You may need to do your own research to fill in the gaps in between lectures and homework/projects. It is impossible to learn data science without getting your hands dirty. Please budget your time evenly. Last-minute work ethic will not work for this course. 

Homework in this course is different from your usual homework assignment as a typical student. Most of the time, they are built over real case studies.  While you will be applying methods covered in lectures, you will also find that extra teaching materials appear here.  The focus will be always on the goals of the study, the usefulness of the data gathered, and the limitations in any conclusions you may draw. Always try to challenge your data analysis in a critical way. Frequently, there are no unique solutions. 

Case studies in each homework can be listed as your data science projects (e.g. on your CV) where you see fit. 


## Objectives 

- Get familiar with `R-studio` and `RMarkdown`
- Hands-on R 
- Learn data science essentials 
    - gather data
    - clean data
    - summarize data 
    - display data
    - conclusion
- Packages
    - `dplyr`
    - `ggplot`

##  Instructions

- **Homework assignments can be done in a group consisting of up to three members**. Please find your group members as soon as possible and register your group on our Canvas site.

- **All work submitted should be completed in the R Markdown format.** You can find a cheat sheet for R Markdown [here](https://posit.co/resources/cheatsheets/) For those who have never used it before, we urge you to start this homework as soon as possible. 

- **Submit the following files, one submission for each group:**  (1) Rmd file, (2) a compiled  HTML or pdf version, and (3) all necessary data files if different from our source data. You may directly edit this .rmd file to add your answers. If you intend to work on the problems separately within your group, compile your answers into one Rmd file before submitting. We encourage that you at least attempt each problem by yourself before working with your teammates. Additionally, ensure that you can 'knit' or compile your Rmd file. It is also likely that you need to configure Rstudio to properly convert files to PDF. [**These instructions**](http://kbroman.org/knitr_knutshell/pages/latex.html#converting-knitrlatex-to-pdf) might be helpful.

- In general, be as concise as possible while giving a fully complete answer to each question. All necessary datasets are available in this homework folder on Canvas. Make sure to document your code with comments (written on separate lines in a code chunk using a hashtag `#` before the comment) so the teaching fellows can follow along. R Markdown is particularly useful because it follows a 'stream of consciousness' approach: as you write code in a code chunk, make sure to explain what you are doing outside of the chunk. 

- A few good or solicited submissions will be used as sample solutions. When those are released, make sure to compare your answers and understand the solutions.

**Use of Generative AI (GAI)**

Generative AI tools (e.g., ChatGPT, Copilot) are permitted for homework assignments and the final project. However, GAI may be used only as an assistant, not as a substitute for your own understanding or work. Students are expected to fully understand, verify, and be able to explain every step of their analysis, including data preparation, exploratory analysis, modeling choices, code, and interpretation of results. In particular, students must be able to write, modify, and debug all code on their own. Reliance on GAI-generated code without understanding is not acceptable. You are fully responsible for the correctness, clarity, and integrity of your submission, regardless of whether GAI was used.





## Review materials

- Study Basic R Tutorial
- Study Advanced R Tutorial (to include `dplyr` and `ggplot`)
- Study lecture 1: Data Acquisition and EDA


# Case study 1: Audience Size

How successful was the Wharton Talk Show **Business Radio Powered by the Wharton School**


**Background:** Have you ever listened to [SiriusXM](https://www.siriusxm.com/)? Do you know there was a **Talk Show** run by Wharton professors in Sirius Radio?  Wharton launched a talk show called **Business Radio Powered by the Wharton School** through the Sirius Radio station in January of 2014. Within a short period of time the general reaction seemed to be overwhelmingly positive. The school would like to **estimate the audience size** in May, 2014. There were 51.6 million Sirius Radio listeners then. One approach is to estimate the proportion of the Wharton listeners to that of the Sirius listeners, $p$, so that we will come up with an audience size estimate of approximately 51.6 million times $p$. 

To do so, we launched a survey via Amazon Mechanical Turk ([MTurk](https://www.mturk.com/)) on May 24, 2014 at an offered price of \$0.10 for each answered survey.  We set it to be run for 6 days with a target maximum sample size of 2000 as our goal. Most of the observations came in within the first two days. The main questions of interest are "Have you ever listened to Sirius Radio" and "Have you ever listened to Sirius Business Radio by Wharton?" A few demographic features used as control variables were also collected; these include Gender, Age and Household Income.  

We requested that only people in United States answer the questions. Each person can only fill in the questionnaire once to avoid duplicates. Aside from these restrictions, we opened the survey to everyone in MTurk with a hope that the sample would be more randomly chosen. 

The raw data is stored as `Survey_results_final.csv` on Canvas.

## Data preparation

1. We need to clean and select only the variables of interest. 

Select only the variables Age, Gender, Education Level, Household Income in 2013, Sirius Listener?, Wharton Listener? and Time used to finish the survey.

Change the variable names to be "age", "gender", "education", "income", "sirius", "wharton", "worktime".

```{r}
survey <- suppressWarnings(
  readr::read_csv(
    "data/Survey_results_final.csv",
    col_types = readr::cols(.default = readr::col_character()),
    show_col_types = FALSE
  )
)

survey <- survey %>%
  select(
    `Answer.Age`,
    `Answer.Gender`,
    `Answer.Education`,
    `Answer.HouseHoldIncome`,
    `Answer.Sirius Radio`,
    `Answer.Wharton Radio`,
    WorkTimeInSeconds
  )

survey <- survey %>%
  rename(
    age      = `Answer.Age`,
    gender   = `Answer.Gender`,
    education= `Answer.Education`,
    income   = `Answer.HouseHoldIncome`,
    sirius   = `Answer.Sirius Radio`,
    wharton  = `Answer.Wharton Radio`,
    worktime = WorkTimeInSeconds
  )

```

2. Handle missing/wrongly filled values of the selected variables

As in real world data with user input, the data is incomplete, with missing values, and has incorrect responses. There is no general rule for dealing with these problems beyond “use common sense.” In whatever case, explain what the problems were and how you addressed them. Be sure to explain your rationale for your chosen methods of handling issues with the data. Do not use Excel for this, however tempting it might be.

Tip: Reflect on the reasons for which data could be wrong or missing. How would you address each case? For this homework, if you are trying to predict missing values with regression, you are definitely overthinking. Keep it simple.

```{r}
colSums(is.na(survey))
survey %>% filter(if_any(everything(), is.na))
survey %>% filter(trimws(tolower(education)) == "select one")

# Removing no age entry.
survey <- survey %>% filter(!is.na(age))

# Changing "select one" entries to "Other"
survey <- survey %>% mutate(education = if_else(tolower(trimws(education)) == "select one", "Other", education))


# Setting NA entries of sirius and wharton to no.
survey <- survey %>%
  mutate(
    sirius  = if_else(is.na(sirius), "No", sirius),
    wharton = if_else(is.na(wharton), "No", wharton)
  )

# Setting NA entries of gender to not specified
survey <- survey %>%
  mutate(
    gender  = if_else(is.na(gender), "Not specified", sirius),
  )

# Setting NA entries of income to $0.
survey <- survey %>%
  mutate(
    income  = if_else(is.na(income), "$0", sirius),
  )

colSums(is.na(survey))

```

It is evident that there are a mix of different attributes which are missing. 
Age: There is one entry with no age. That row will be invalidated, as all people have ages. 
Gender: There are a couple entries with no gender. Looking at the data manually, the only other genders are Male and Female. People may identify with different genders, explaining the NA entries.
Education: No entries are NA, however there were 19 entries that had "select one". These entries have been renamed to "Other".
Income: NA income entries are be interpreted as the survey participant being unemployed.
Sirius / Wharton: NA entries will be treated as false.


3. Brief summary 

Write a brief report to summarize all the variables collected. Include both summary statistics (including sample size) and graphical displays such as histograms or bar charts where appropriate. Comment on what you have found from this sample. (For example - it's very interesting to think about why would one work for a job that pays only 10cents/each survey? Who are those survey workers? The answer may be interesting even if it may not directly relate to our goal.)

```{r}

survey %>% count(sirius)
survey %>% count(wharton)

survey %>%
  count(education) %>%
  ggplot(aes(x = education, y = n, fill = education)) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  guides(fill = "none")





```


## Sample properties

The population from which the sample is drawn determines where the results of our analysis can be applied or generalized. We include some basic demographic information for the purpose of identifying sample bias, if any exists. Combine our data and the general population distribution in age, gender and income to try to characterize our sample on hand.

1. Does this sample appear to be a random sample from the general population of the USA? Why it is crucial to have randomness here?

```{r}


```

2. Does this sample appear to be a random sample from the MTURK population?




Note: You can not provide evidence by simply looking at our data here. For example, you need to find distribution of education in our age group in US to see if the two groups match in distribution. You may need to gather some background information about the MTURK population to have a slight sense if this particular sample seem to a random sample from there... Please do not spend too much time gathering evidence. 

## Final estimate

Provide an approximate **95\% confidence interval** of the Wharton audience size by May of 2014. Assume that the sample is a random sample of the MTURK population, and that the proportion of Wharton listeners vs. Sirius listeners in the general population is the same as that in the MTURK population. Write a brief executive summary to summarize your findings and how you came to that conclusion.


1. Goal of the study
2. Method used: data gathering, estimation methods
3. Findings
4. Limitations of the study. 


## New task

Now suppose you are asked to design a study to estimate the audience size of Wharton Business Radio Show as of today: You are given a budget of $1000. You need to present your findings in two months. 

Write a proposal for this study which includes:

1. Method proposed to estimate the audience size.
2. What data should be collected and where it should be sourced from. (Can we use ChatGPT to get us a rough estimate?)

Please fill in the google form to list your platform where surveys will be launched and collected [HERE](https://forms.gle/8SmjFQ1tpqr6c4sa8) 


A good proposal will give an accurate estimation with the least amount of money used. 





# Case study 2: Women in Science

Are women underrepresented in science in general? How does gender relate to the type of educational degree pursued? Does the number of higher degrees increase over the years? In an attempt to answer these questions, we assembled a data set (`WomenData_06_16.xlsx`) from [NSF](https://ncses.nsf.gov/pubs/nsf19304/digest/field-of-degree-women) about various degrees granted in the U.S. from 2006 to 2016. It contains the following variables: Field (Non-science-engineering (`Non-S&E`) and sciences (`Computer sciences`, `Mathematics and statistics`, etc.)), Degree (`BS`, `MS`, `PhD`), Sex (`M`, `F`), Number of degrees granted, and Year.

Our goal is to answer the above questions only through EDA (Exploratory Data Analyses) without formal testing. We have provided sample R-codes in the appendix to help you if needed. 

## Data preparation  

### Understand and clean the data

Notice the data came in as an Excel file. We need to use the package `readxl` and the function `read_excel()` to read the data `WomenData_06_16.xlsx` into R. 

#### Read the data into R.

```{r}
women_data <- read_excel("data/WomenData_06_16.xlsx")
w_data <- women_data
```

#### Clean the names of each variables. (Change variable names to  `Field`,`Degree`, `Sex`, `Year` and `Number` )

```{r}
colnames(w_data)
w_data <- w_data %>%
  rename(`Field` = `Field and sex`,
         `Number` = `Degrees Awarded`)
colnames(w_data)
```

#### Set the variable natures properly. 

```{r}
w_data <- w_data %>%
  mutate( Field = as.factor(Field),
          Degree = as.factor(Degree),
          Sex = as.factor(Sex)
          )
summary(w_data)
```

#### Any missing values?

```{r}
colSums(is.na(w_data)
        )
```

### Write a summary describing the data set provided here. 

#### How many fields are there in this data?

```{r}
dim(w_data)
```

There are 5 different variables (Field, Degree, Sex, Year and Number), and 660 data entries in the data set.

#### What are the degree types?

```{r}
unique(w_data$Field)
```
There are 10 degree types: Agricultural Sciences; Biological Sciences; Computer Sciences; Earth, Atmospheric, and Ocean Sciences; Mathematics and Statistics; Physical Sciences; Psychology; Social Sciences; Engineering; and Non-S&E.

#### How many year's statistics are being reported here? 

```{r}
length(unique(w_data$Field)
       )
```

10 years of statistic are being reports (2006 - 2016).

## BS degrees in 2015

### Is there evidence that more males are in science-related fields vs `Non-S&E`? Provide summary statistics and a plot which shows the number of people by gender and by field. Write a brief summary to describe your findings.

The number of males and females in S&E were relatively similar in 2015 with 327,122 and 322,935 people graduating respectively. This is visualised in the Bar Chart where the bars for Male and Female S&E Graduates is essentially the same. Furthermore, this shows that there are many more gradutes in non-S&E courses compared with S&E courses. However, this could be attributed to a limited range of degrees available in S&E courses compared with non-S&E courses.

```{r}
w_data %>%
  filter(Year == 2015, Degree == "BS") %>%
  mutate(SE = ifelse(Field!="Non-S&E" , "S&E", "Non-S&E")) %>%
  group_by(SE, Sex) %>%
  summarise(SE_number = sum(Number), .groups = "drop") %>%
  ggplot(aes(x = SE, y = SE_number, fill = Sex)) +
  geom_col(position = "dodge") +
  theme(axis.text.y = element_text(angle = 60)) +
  labs(
      title = "Number of Bachelor Graduates by Gender, Degree Type and Field (2015)",
      x = "Field",
      y = "Number of Graduates",
      fill = "Gender"
    )
```

```{r include=TRUE, results='asis', echo=FALSE}
tab <- w_data %>%
  filter(Year == 2015, Degree == "BS") %>%
  mutate(SE = ifelse(Field!="Non-S&E" , "S&E", "Non-S&E")) %>%
  group_by(SE, Sex) %>%
  summarise(Total = sum(Number),
            .groups = "drop")

knitr::kable(tab, digits = 2, caption = "Summary statistics by S&E group and gender in 2015")
```

## EDA bringing type of degree, field and gender in 2015

### Describe the number of people by type of degree, field, and gender. Do you see any evidence of gender effects over different types of degrees? Again, provide graphs to summarize your findings.

The number of people pursuing courses in Bachelors and Masters degrees in 2015 is very unequal with around 1,500,000 and 700,000 graduating in Mathematics and Statistics respectively, compared with all of the other courses where graduates numbered less than around 200,000. This pattern is evident in PhD courses to a less extent, with around 30,000 people graduating in Mathematics and Statistics compared with less than 10,000 for the other subject areas.

Females make up a larger proportion of graduates in Mathematics and Statistics as well as Physical Sciences across all three degree types. Conversely, Males comprise the most graduates in the subject area  Earth, Atmospheric and Ocean Sciences, with the remaining topics being relatively equally weighted in relation to gender.

```{r}
w_data %>%
  filter(Year == 2015, Degree == "BS") %>%
  ggplot(aes(x = Field, y = Number, fill = Sex)) +
  geom_col(position = "dodge") +
  labs(
    title = "Number of Bachelor Graduates by Gender and Field (2015)",
    x = "Field",
    y = "Number of Graduates",
    fill = "Gender"
  ) + 
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```
```{r}
w_data %>%
  filter(Year == 2015, Degree == "MS") %>%
  ggplot(aes(x = Field, y = Number, fill = Sex)) +
  geom_col(position = "dodge") +
  labs(
    title = "Number of Masters Graduates by Gender and Field (2015)",
    x = "Field",
    y = "Number of Graduates",
    fill = "Gender"
  ) + 
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```

```{r}
w_data %>%
  filter(Year == 2015, Degree == "PhD") %>%
  ggplot(aes(x = Field, y = Number, fill = Sex)) +
  geom_col(position = "dodge") +
  labs(
    title = "Number of PhD Graduates by Gender and Field (2015)",
    x = "Field",
    y = "Number of Graduates",
    fill = "Gender"
  ) + 
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```

## EDA bring all variables 

### In this last portion of the EDA, we ask you to provide evidence numerically and graphically: Do the number of  degrees change by gender, field, and time? 

Overtime, females have consistently had more graduates in subject areas including Agricultural Sciences, Biological Sciences, Non-S&E, Psychology and Social Sciences. This differs to Computer Science, Earth, Atmospheric and Ocean Sciences, Engineering, Mathematics and Statistics and Physical Sciences which have consistently more male graduates each year.

All subject areas have experienced strong growth in graduate numbers, however, Earth, Atmospheric and Ocean Sciences, and Social Sciences have experienced slower growth in the past three years, with Social Sciences even falling in popularity.

Finally, Agricultural Sciences and Earth, Atmospheric and Ocean Sciences initially had relatively equal numbers of male and femal graduates in 2006, however, both have diverged significantly over the 10 years. This has resulted in females studying Agricultural Sciences more and males studying Earth, Atmospheric and Ocean Sciences more.

```{r}
w_data %>%
  group_by(Year, Field, Sex) %>%
  summarise(total_degrees = sum(Number), .groups = "drop") %>%
  ggplot(aes(x = Year, y = total_degrees, color = Sex)) +
  geom_line() +
  facet_wrap(~ Field, scales = "free_y") +
  labs(
    title = "Degrees Over Time by Gender and Field Group",
    x = "Year",
    y = "Number of Degrees",
    color = "Gender"
  ) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))
```


## Women in Data Science

### Finally, is there evidence showing that women are underrepresented in data science? Data science is an interdisciplinary field of computer science, math, and statistics. You may include year and/or degree.

Yes, females have been underrepresented in data science consistently across the decade. Whilst the total number of females studying this subject area have increased from 10,000 to 12,000, they are still significantly less than the current 53,000 males gradutates, and have experienced much slower growth in popularity compared with the 15,000 increase in males.

```{r}
w_data %>%
  filter(Field %in% c("Computer sciences", "Mathematics and statistics")) %>%
  ggplot(aes(x = Year, y = Number, fill = Sex)) +
  geom_col(position = "dodge") +
  labs(
    title = "Number of Graduates by Gender in Data Science",
    x = "Year",
    y = "Number of Graduates",
    fill = "Gender"
  )
```

## Final brief report

### Summarize your findings focusing on answering the questions regarding if we see consistent patterns that more males pursue science-related fields. Any concerns with the data set? How could we improve on the study?

Over the 10 year study, we consistently see males pursuing science-related fields more than females. Moreover, this gender gap has almost doubled over this time period.

This study raised no issues about the integrity or quality of the data set. An addition could be considering individuals who study majors from different schooles (S&E and non-S&E). The reason for why females are underrepresented may be because they are not having their full degree structure reported in this study (e.g. someone could major in English and Chemistry in an Arts Degree - this would be shown as Non-S&E).

To improve this study this experiment should be repeated numerous times, improving validity and reliability. Furthermore, it should be conducted across multiple universities in the same region, limiting the impact of potential bias from the current test population.

```{r}
  w_data %>%
  mutate(SE = ifelse(Field!="Non-S&E" , "S&E", "Non-S&E")) %>%
  group_by(Year, SE, Sex) %>%
  summarise(SE_number = sum(Number), .groups = "drop") %>%
  ggplot(aes(x = Year, y = SE_number, color = Sex)) +
  geom_line() +
  facet_wrap(~ SE, scales = "free_y") +
  labs(
    title = "Graduates Over Time by Gender: S&E vs Non-S&E",
    x = "Year",
    y = "Number of Graduates",
    color = "Gender"
  )
```



# Case study 3: Major League Baseball

We would like to explore how payroll affects performance among Major League Baseball teams. The data is prepared in two formats record payroll, winning numbers/percentage by team from 1998 to 2014. 

Here are the datasets:

- `MLPayData_Total.csv`: wide format
- `baseball.csv`: long format

Feel free to use either dataset to address the problems. 

## EDA: Relationship between payroll changes and performance

Payroll may relate to performance among ML Baseball teams. One possible argument is that what affects this year's performance is not this year's payroll, but the amount that payroll increased from last year. Let us look into this through EDA. 

Create increment in payroll

a). To describe the increment of payroll in each year there are several possible approaches. Take 2013 as an example:

    - option 1: diff: payroll_2013 - payroll_2012
    - option 2: log diff: log(payroll_2013) - log(payroll_2012)

Explain why the log difference is more appropriate in this setup.

b). Create a new variable `diff_log=log(payroll_2013) - log(payroll_2012)`. Hint: use `dplyr::lag()` function.

c). Create a long data table including: team, year, diff_log, win_pct


## Exploratory questions

a). Which five teams had highest increase in their payroll between years 2010 and 2014, inclusive?

b). Between 2010 and 2014, inclusive, which team(s) "improved" the most? That is, had the biggest percentage gain in wins?


## Do log increases in payroll imply better performance? 

Is there evidence to support the hypothesis that higher increases in payroll on the log scale lead to increased performance?

Pick up a few statistics, accompanied with some data visualization, to support your answer. 

## Comparison

Which set of factors are better explaining performance? Yearly payroll or yearly increase in payroll? What criterion is being used? 

## Using GAI to go one step beyond EDA

You are encouraged to use Generative AI (GAI) (e.g., ChatGPT, Copilot) as an assistant for this question.

Using the payroll and performance data, ask a GAI tool to suggest a reasonable way to study the relationship between payroll and team performance beyond simple plots, building on what we learned from EDA.

Briefly address the following:

+ Process
How did you use GAI to guide your analysis? What steps did you follow after EDA?

+ What makes the analysis better than basic EDA?
Explain what criteria you used to judge that this approach is an improvement (e.g., uses more information, reduces misleading aggregation, clearer comparison).

+ Conclusion
What do you learn about the relationship between payroll and performance? What are the limits of this conclusion?

Notes:

+ GAI may only be used as an assistant.
+ You must understand and be able to explain all code and results you include.
+ There is no single correct answer; clarity and reasoning matter more than sophistication.






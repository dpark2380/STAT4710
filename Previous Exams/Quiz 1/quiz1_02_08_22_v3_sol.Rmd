---
title: 'Quiz 1'
author: "Modern Data Mining/Linda"
date: "February 8, 2022"
output:
  pdf_document:
    keep_tex: yes
  html_document:
    df_print: paged
fontfamily: mathpazo
fontsize: 11pt
geometry: margin=1in
header-includes:
- \linespread{1.05}
- \usepackage{framed}
- \usepackage{fancyvrb}
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
knitr::opts_chunk$set(fig.height=5, fig.width=8, warning = F)
options(scipen = 1, digits = 2)
library(tidyverse)
library(magrittr)
library(ggplot2)
library(gridExtra)
```

\makebox[\textwidth]{\textbf{Name}: \enspace\hrulefill}
\vspace{0.4in}
\makebox[\textwidth]{\textbf{Section (471, 571, 701)}:\enspace\hrulefill}


This is an open book, 10-minute quiz. Choose the correct answer(s). There might be more than one right answer in some questions. No calculations are needed. 

Customer segmentation (clustering) is a process of identifying customers into a few distinctive groups. Within each group people share some common characteristics. The ultimate goal is, for example, to identify high yield segments so that more effort will be devoted to those group. 

In this case study we use a dataset coming from Portuguese city regions (Lisbon, Oporto and others) which refers to clients of a wholesale distributor. It includes the annual spending in monetary units on diverse product categories. The dataset is available at UCI machine learning repository at [HERE](https://archive.ics.uci.edu/ml/datasets/wholesale+customers). Unfortunately no detailed information is available in the data. 

Our goal is to do some basic EDA to understand the data before running sensible clustering analysis (not done here).

The data contains the following information: 

- `Channel`: customers' Channel --- **1 (Hotel/Restaurant/Cafe) or 2 (Retail)** 
- `Region`: customers' Region --- **1 (Lisbon), 2 (Oporto) or 3 (Other)**
- `Fresh`: annual spending on fresh products (continuous)
- `Milk`: annual spending on milk products (continuous) 
- `Grocery`: annual spending on grocery products (continuous)
- `Frozen`: annual spending on frozen products (continuous) 
- `Detergents_Paper`: annual spending on detergents and paper products (continuous) 
- `Delicassen`: annual spending on and delicatessen products (continuous)



**1.** Let us first read and manipulate the data. The variable `Client` stands for the unique numerical ID of each client. 

The data is named as  `wholesale` which keeps all the original variables. We list the first three clients in the dataset:
```{r, read data wholesale, comment=" "}
url <- 'https://archive.ics.uci.edu/ml/machine-learning-databases/00292/Wholesale%20customers%20data.csv'
wholesale <- read_csv(url)
wholesale <- wholesale %>% 
  mutate(Channel = as.factor(Channel),Region = as.factor(Region)) %>% 
  rownames_to_column('Client')
head(wholesale, 3)
```

Log (base 10) is applied to the spending for all the variables. And the data is referred to as `wholesale_log`. The information for the first 3 clients is also listed here:
```{r, comment= " "}
wholesale_log <- wholesale %>% 
  mutate(Fresh = log10(Fresh), Milk = log10(Milk), Grocery = log10(Grocery),
         Frozen = log10(Frozen), Detergents_Paper = log10(Detergents_Paper), 
         Delicassen = log10(Delicassen))
head(wholesale_log, 3)
```

Choose the correct description(s) for the two data frames `wholesale` and `wholesale_log`.

(A) The `Client` 2 spends 8.10 monetary units on detergents and paper products.

(B) The `Client` 1 in `wholesale` and `wholesale_log` indicate the same client.

**The answer is (B).**




**2.** Here are some summaries of variables in the dataset.

```{r, comment= " "}
summary(wholesale)
```

True or false? We see the dataset `wholesale` contains missing values.

(A) True

(B) False

(C) Not enough information


**The answer is (B).**


**3.** Let us take a look at the dataset more closely.

We next arrange the `wholesale` by sorting `Milk` in an ascending order. The first three and the last three clients are listed below. 

**Recall:**

- `Channel`: customers' Channel --- **1 (Hotel/Restaurant/Cafe) or 2 (Retail)** 
- `Region`: customers' Region --- **1 (Lisbon), 2 (Oporto) or 3 (Other)**

```{r, comment=" "}
wholesale %>% arrange(Milk) %>% head(3)
wholesale %>% arrange(Milk) %>% tail(3)
```

Choose the correct description(s). 

(A) The client who spends the least amount on milk products comes from the Hotel/Restaurant/Cafe channel.

(B) The client who spends the most amount on milk products spends 987 monetary units on frozen products.


**The answer is (A) and (B).**



**4.** We next count the number of clients in each channel.
```{r}
ggplot(wholesale) + geom_bar(aes(x=Channel))
```

Which channel do the clients in the dataset come from the most?

(A) 1:Hotel/Restaurant/Cafe

(B) 2:Retail


**The answer is (A).**



**5.** We would further analyze the spending on fresh products with respect to the clients' channel and region.

```{r}
wholesale_log %>% ggplot() + 
  geom_boxplot(aes(x = Region, y = Fresh, fill = Channel)) +
  labs( title = "Box plots of Fresh by Channel and Region")
  
```

**Recall:**

- `Channel`: customers' Channel --- **1 (Hotel/Restaurant/Cafe) or 2 (Retail)** 
- `Region`: customers' Region --- **1 (Lisbon), 2 (Oporto) or 3 (Other)** 

True or false? Based on the boxplot, the median spending of clients from the Hotel/Restaurant/Cafe channel is higher than that of clients from the Retail channel regardless of region.

(A) True.

(B) False.


**The answer is (A).**


**6.** Assume the log-spending on delicatessen products follows a normal distribution with mean to be `r round(mean(wholesale_log$Delicassen), 2)` and the standard deviation to be 
`r round(sd(wholesale_log$Delicassen), 2)`. The density plot below supports our assumption.

```{r}
wholesale_log %>% ggplot(aes(x=Delicassen)) +
  geom_histogram(aes(y=..density..), alpha=.5) +
  geom_density()
```

Roughly 95% of the clients' log-spending on delicatessen products falls on the interval:

(A) $[`r round(mean(wholesale_log$Delicassen), 2)` - `r round(mean(wholesale_log$Delicassen), 2)`, `r round(mean(wholesale_log$Delicassen), 2)` + `r round(mean(wholesale_log$Delicassen), 2)`]$

(B) $[`r round(mean(wholesale_log$Delicassen), 2)` - 2\times `r round(mean(wholesale_log$Delicassen), 2)`, `r round(mean(wholesale_log$Delicassen), 2)` + 2\times `r round(mean(wholesale_log$Delicassen), 2)`]$


**The answer is (B).**


<!-- **7.** The following scatter plot shows the relationship between `Grocery` and `Fresh`. -->

<!-- ```{r} -->
<!-- wholesale_log %>% ggplot() + -->
<!--   geom_point(aes(x=Grocery, y=Fresh, color=Region, shape=Channel)) -->
<!-- ``` -->

<!-- True or False: the clients with high grocery spending are likely to spend much on fresh products. -->

<!-- (A) True -->

<!-- (B) False -->


**7-9.** We perform principal component analysis among all the annual spending on the log-scale. 

```{r}
pca <- wholesale_log %>% select(Fresh:Delicassen) %>% prcomp(scale=T)
```

Here is some available information from PCA.

```{r comment=" "}
pca$rotation
summary(pca)$importance
```

**7.** True or false? The first principal component is a weighted sum of all 6 variables.

(A) True

(B) False


**The answer is (B).**

**8.** The first three principal components explain the following amount of the total variation:

(A) 11%

(B) 54%

(C) 82%

**The answer is (C).**

**9.** The first principal component can be written as the following linear combination:
$$
\texttt{PC1} = c_1 \times \texttt{Fresh} + c_2 \times \texttt{Milk} + c_3 \times \texttt{Grocery} + c_4 \times \texttt{Frozen} + c_5 \times \texttt{Detergents\_Paper} + c_6 \times \texttt{Delicassen}
$$
Which is the correct value of $c_5$?

(A) 0.55

(B) -0.14

(C) -0.0686

**The answer is (A).**


Here we list the PC scores for the first 6 clients:
```{r}
pca$x[1:6, ]
```
**10.** Which client has the largest loading on PC2 in magnitude (i.e., the absolute value) among the `Client` 1-6? (We took this question out of the quiz)

(A) `Client` 1

(B) `Client` 3

(C) `Client` 5

**The answer is (C)**


